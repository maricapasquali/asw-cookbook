<template>
  <b-card class="card-comments">

    <!-- Commenting -->
    <div class="add-comment">
      <b-row>
        <b-col>
          <div class="d-flex justify-content-end">
            <b-button ref="btn-comment" variant="link" v-b-toggle="editorAddComment">Commenta</b-button>
          </div>
          <b-collapse :id="editorAddComment">
            <mini-text-editor @end-edit="addComments"  @close="closeEditorComment">
              <template #edit>Commenta</template>
            </mini-text-editor>
          </b-collapse>
        </b-col>
      </b-row>
    </div>

    <!-- LIST  COMMENTS -->
    <b-row v-for="comment in value" :key="comment._id" class="comment-text" align-h="center" cols="1" cols-sm="1">
      <b-col> <comment :comment="comment" :recipe="recipe" :language="language"/> </b-col>
    </b-row>
  </b-card>

</template>

<script>
import {Session} from "@services/session";

import api from '@api'

export default {
  name: "comments",
  props: {
    value:  Array,
    recipe: Object,
    language: {
      type: String,
      default: 'it'
    },
  },

  computed:{
    editorAddComment(){
      return 'editor-comment-'+ this.recipe.id
    },
  },

  methods: {
    closeEditorComment(){
      let editorBtn = this.$refs["btn-comment"]
      if(editorBtn) editorBtn.click()
    },

    addComments(text){
      api.recipes
         .comments
         .createComment(this.recipe.ownerID, this.recipe.id, {content: text}, Session.accessToken())
         .then(({data})=> {
           this.value.push(data)
           //this.$emit('input', [...this.value, ...[data]])
           console.log('You commented.')
         })
          //TODO: HANDLER ERROR ADD COMMENT TO RECIPE
         .catch(err => console.error(err))
    },
  }
}
</script>

<style scoped lang="scss">

.card-comments{
  background-color: $component-color;
  border: none;

  & .add-comment button{
    color: white;
  }
  & .card-body{
    color: black
  }
}

</style>